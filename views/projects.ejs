<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects</title>
    <%- include('partials/head') %>
</head>
<body>
    <%- include('partials/header') %>
    <div class="client-profile-container down-fivepercent" style="margin-left: 2em;">
        <h2>Projects</h2>
        <a href="/client/projects/new" class="btn" style="margin-bottom: 1em; display: inline-block; background-color: teal; color: white; padding: 0.5em 1em; text-decoration: none; border-radius: 0.3em;">Create New Project</a>
        
        <% if (projects && projects.length > 0) { %>
            <div class="projects-list">
                <% projects.forEach(project => { %>
                    <div class="project-card" style="border: 1px solid #ddd; padding: 1em; margin: 1em 0; border-radius: 0.5em; background-color: #f9f9f9;">
                        <h3><%= project.title %></h3>
                        <p><strong>Created by:</strong> <%= project.createdBy ? project.createdBy.name : 'Unknown' %></p>
                        <p><strong>Type:</strong> <%= project.type %></p>
                        <p><strong>Location:</strong> <%= project.location || 'Not specified' %></p>
                        <p><strong>Budget:</strong> â‚¬<%= project.price %></p>
                        <p><strong>Description:</strong> <%= project.description || 'No description' %></p>
                        
                        <% if (project.images && project.images.length > 0) { %>
                            <div class="project-gallery" style="display: flex; gap: 0.5em; margin-top: 1em;">
                                <% project.images.forEach(img => { %>
                                    <img src="<%= img %>" alt="Project Image" style="width: 100px; height: 100px; object-fit: cover; border-radius: 5px;"/>
                                <% }) %>
                            </div>
                        <% } %>
                        
                        <div class="project-actions" style="margin-top: 1em; display: flex; gap: 0.5em;">
                            <a href="/client/projects/<%= project._id %>/edit" class="btn" style="background-color: #007bff; color: white; padding: 0.5em 1em; text-decoration: none; border-radius: 0.3em; font-size: 0.9em;">Edit Project</a>
                            <form action="/client/projects/<%= project._id %>/delete" method="POST" style="display: inline;" onsubmit="return confirm('Are you sure you want to delete this project? This action cannot be undone.');">
                                <button type="submit" class="btn" style="background-color: #dc3545; color: white; padding: 0.5em 1em; text-decoration: none; border-radius: 0.3em; font-size: 0.9em; border: none; cursor: pointer;">Delete Project</button>
                            </form>
                        </div>
                        
                        <!-- Comments Section -->
                        <div class="project-comments" style="margin-top: 1em; border-top: 1px solid #ddd; padding-top: 1em;">
                            <h4>Comments</h4>
                            
                            <% if (user) { %>
                                <!-- Add Comment Form -->
                                <form action="/client/projects/<%= project._id %>/comment" method="POST" style="margin-bottom: 1em;">
                                    <textarea name="comment" placeholder="Add a comment..." style="width: 100%; min-height: 60px; padding: 0.5em; border: 1px solid #ddd; border-radius: 0.3em; resize: vertical;" required></textarea>
                                    <button type="submit" style="background-color: #28a745; color: white; padding: 0.5em 1em; border: none; border-radius: 0.3em; cursor: pointer; margin-top: 0.5em;">Add Comment</button>
                                </form>
                            <% } else { %>
                                <p style="color: #666; font-style: italic;">Please <a href="/auth/login">login</a> to add comments.</p>
                            <% } %>
                            
                            <!-- Display Comments -->
                            <% if (project.comments && project.comments.length > 0) { %>
                                <div class="comments-list">
                                    <% project.comments.forEach(comment => { %>
                                        <div class="comment" style="border: 1px solid #eee; padding: 0.8em; margin: 0.5em 0; border-radius: 0.3em; background-color: #f9f9f9;">
                                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5em;">
                                                <strong style="color: #333;"><%= comment.userName %></strong>
                                                <small style="color: #666;"><%= new Date(comment.createdAt).toLocaleDateString() %></small>
                                            </div>
                                            <p style="margin: 0; color: #555;"><%= comment.comment %></p>
                                        </div>
                                    <% }) %>
                                </div>
                            <% } else { %>
                                <p style="color: #666; font-style: italic;">No comments yet. Be the first to comment!</p>
                            <% } %>
                        </div>
                    </div>
                <% }) %>
            </div>
        <% } else { %>
            <p>No projects found.</p>
        <% } %>
    </div>
</body>
</html> 